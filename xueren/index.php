<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
<link rel="stylesheet" type="text/css" href="http://yslp.qq.com/snowboy/style.css" />
<script src="http://yslp.qq.com/js/core/jquery.js"></script>
<title>淘气的小雪人</title>
<style>
*{-moz-user-select:none;-webkit-user-select:none;}
</style>
</head>
<body unselectable="on" style="-moz-user-select:none;-webkit-user-select:none;" onselectstart="return false;">
<div class="layout" >
	<p class="back_bg back_bg_anm"></p>
	<p class="back_bg_2 back_bg_anm"></p>
	<ul class="pits pits_anm">
		<li class="current"><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
		<li><span><em></em></span><i></i></li>
	</ul>


	<!-- wanmei begin -->
	<div class="wanmei">&nbsp;</div>
	<!-- wanmei over -->
	<div class="snowball"></div>
	<div class="winNum">0</div>
	<div class="start_cover"></div>
	<div class="snowMan wait"></div>
	
	<!-- sound begin -->

	<!-- 背景音乐 -->
	<div style="position:absolute; z-index:-2; left:0; top:0;">
		<audio src="http://mat1.gtimg.com/yslp/snowboy/mc_bg.mp3" controls="controls" loop="loop" id="mc_bg"></audio>

		<!-- 欢迎音 -->
		<audio src="http://mat1.gtimg.com/yslp/snowboy/greet.mp3" id="greet"></audio>

		<!-- 欢呼 -->
		<audio src="http://mat1.gtimg.com/yslp/snowboy/hail.mp3" id="hail"></audio>

		<!-- 沮丧 -->
		<audio src="http://mat1.gtimg.com/yslp/snowboy/chapfallen.mp3" id="chapfallen"></audio>

		<!-- 再来一次 -->
		<audio src="http://mat1.gtimg.com/yslp/snowboy/agian.mp3" id="agian"></audio>

		<!-- 分享声音 -->
		<audio src="http://mat1.gtimg.com/yslp/snowboy/zan.mp3" id="zan"></audio>
	</div>

	<!-- sound Over -->
</div>
<a href="javascript:void(0);" class="btn_mc"></a>



<!-- cover begin -->
<div class="cover">
	<p>腾讯网设计中心 出品</p>
	<a href="javascript:void(0);" class="btn_start"></a>
</div>
<!-- cover over -->


<!-- loading begin -->
<div class="loading">
	<div><div class="loadingProgress"></div><p></p></div>
</div>
<!-- loading over -->

<!-- pop over begin -->
<div class="pop_over">
	<div>
		<p>你成功跨越了<i></i>个大坑</p>
		<p class="h">自从下了雪，摩擦摩擦都有劲儿了呢</p>
		<p class="margin20">
			<a href="javascript:void(0);" class="restart ac_restart"><img src="http://mat1.gtimg.com/yslp/snowboy/btn_restart.png" /></a>
			<a href="javascript:void(0);" class="share ac_share"><img src="http://mat1.gtimg.com/yslp/snowboy/btn_share.png" /></a>
		</p>
	</div>
	<p class="popSnowMan"></p>
</div>
<!-- pop over over -->

<!-- share begin -->
<div class="sharePop"></div>
<!-- share over -->

<script>
// 微信分享
var wxTitle = '我在【淘气的小雪人】中跨过了0个坑，有超过我的吗？';
var wxDesc = '没见过雪的孩子慎点，真的停不下来';
var wxImg = 'http://mat1.gtimg.com/yslp/snowboy/share.png';
var shareLink = location.href;
var onBridgeReady = function() {
	// 分享到朋友圈;
	WeixinJSBridge.on('menu:share:timeline', function(argv) {
		WeixinJSBridge.invoke('shareTimeline', {
			"img_url": wxImg,
			"img_width": "160",
			"img_height": "160",
			"link": shareLink,
			"desc": wxDesc,
			"title": wxTitle
		}, function() {});
	})
	WeixinJSBridge.on('menu:share:appmessage', function(argv) {
		WeixinJSBridge.invoke('sendAppMessage', {
			"img_url": wxImg,
			"link": shareLink,
			"desc": wxDesc,
			"title": wxTitle
		}, function() {})
	})
	WeixinJSBridge.on('menu:share:weibo', function(argv) {
		WeixinJSBridge.invoke('shareWeibo', {
			"desc": wxDesc,
			"url": shareLink,
		}, function(res) {});
	})
}
document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);


/**
 * loadImg  图片预加载
 */
var loadImg = function(pics, callback){
    var index = 0;
    var len = pics.length;
    var img = new Image();
    var flag = false;
    var progress = function(w){
	    //console.log(w)
        $('.loadingProgress').stop().animate({width:w});
    }
    var load = function(){
        img.src = pics[index];
        img.onload = function() {
            // 控制台显示加载图片信息
            progress(Math.floor(((index + 1) / len) * 100) + "%");
            index ++ ;
            if (index < len) {
                load();
            }else{
                callback()
            }
        }
        return img;
    }
    if(len > 0){
        load();
    }else{
        progress("100%");
    }
    return {
        pics: pics,
        load: load,
        progress: progress
    };
}
var pics = ['http://mat1.gtimg.com/yslp/snowboy/bg.png','http://mat1.gtimg.com/yslp/snowboy/bg_2.png','http://mat1.gtimg.com/yslp/snowboy/btn_start.png','http://mat1.gtimg.com/yslp/snowboy/cover_shu.jpg','http://mat1.gtimg.com/yslp/snowboy/fallen.png','http://mat1.gtimg.com/yslp/snowboy/keng.png','http://mat1.gtimg.com/yslp/snowboy/keng_x.png','http://mat1.gtimg.com/yslp/snowboy/loading_txt.png','http://mat1.gtimg.com/yslp/snowboy/pop_over.png','http://mat1.gtimg.com/yslp/snowboy/share.png','http://mat1.gtimg.com/yslp/snowboy/sm.png','http://mat1.gtimg.com/yslp/snowboy/throw.png','http://mat1.gtimg.com/yslp/snowboy/wait.png','http://mat1.gtimg.com/yslp/snowboy/walk.png','http://mat1.gtimg.com/yslp/snowboy/win_num.png','http://mat1.gtimg.com/yslp/snowboy/btn_restart.png','http://mat1.gtimg.com/yslp/snowboy/btn_share.png','http://mat1.gtimg.com/yslp/snowboy/wm_f.png'];
// 调用
loadImg(pics, function(){
    setTimeout(function(){
       loadingHide();
       setKeng();
    }, 1200);
});

$(function(){
	var $window = $(window),
		$pits = $('.pits'),
		$pits_li = $pits.find('li'),
		$snowball = $('.snowball'),
		ballDelay = 30,
		$back_bg = $('.back_bg'),
		$back_bg_2 = $('.back_bg_2'),
		$winNum = $('.winNum'),
		$start_cover = $('.start_cover')
	;
	$back_bg.add($back_bg_2).width($window.width()*$pits_li.length);
	//console.log($pits_li.length);

	// 设置每个坑的大小和位置
	var keng_i_w_h = 888/116;
	var keng_x_w_h = 888/178;
	function setKeng(){
		$pits_li.width($window.width());
		$pits_li.each(function(i,item){
			var $item = $(item);
			var i_w = rand_num(10)*8 + 70;
			var i_h = i_w/keng_i_w_h;
			var $item_span = $item.find('span');
			$item_span.css({
				'width':i_w,
				'left':i == 0?$window.width()/2:i*$window.width() + $window.width()/2,
				'height':$item_span.height(),
				'top':i_h
			});
			$item.find('i').css({
				'width':i_w,
				'height':i_h,
				'left':i == 0?$window.width()/2:i*$window.width() + $window.width()/2
			});
			$item.find('em').css({
				'top':-i_h/2
			});
		});
	}
	window.setKeng = setKeng;


	// 判断显示横版还是竖版封面
	var $cover = $('.cover');

	// loadingHide
	var $loading = $('.loading');
	function loadingHide(){
		$loading.css({
			'opacity':0
		});
		setTimeout(function(){
			$loading.hide();
		},400);
		// 雪人等待动画开启
		snowWait();
		// 播放欢迎声音
		clearTimeout(timeLoadingText);
	}
	window.loadingHide = loadingHide;

	// loading text
	var loadText = ['别着急，游戏马上开始','总以为捧在手心就会属于我，但雪不是','喜欢脚踩在雪地上，摩擦摩擦','妈妈说，有耐心的都是好孩子','没堆过雪人，还没吃过小雪人雪糕嘛'];
	var loadInt = 0;
	var timeLoadingText = null;
	var $loadingText = $loading.find('>div>p');
	function loadingText(){
		$loadingText.html(loadText[loadInt]);
		if(loadInt < loadText.length - 1){
			loadInt += 1;
		}else{
			loadInt = 0;
		}
		timeLoadingText = setTimeout(loadingText,2000);
	}
	loadingText();

	// 结束弹出层的大小计算
	var popover_w_h = 786/685;
	var $popover= $('.pop_over');
	var $popover_h = $popover.find('.h');
	var $popover_i = $popover.find('i');
	var overTxt = ['自从下了雪，摩擦摩擦都有劲儿了呢','你们家下雪了吗','喜欢雪的都是纯洁的好孩子','腾讯网UED祝你新年快乐','想找一个人陪我去看雪','下雪了，约吗？'];
	function popOverSize(){
		$popover.css({
			'height': $popover.width()/popover_w_h,
			'margin-top': -$popover.width()/popover_w_h/2
		});	
	}
	popOverSize();
	
	function showPopOver(){
		$popover_i.html($winNum.html());
		//console.log(overTxt[parseInt(Math.random()*5)]);
		$popover_h.html(overTxt[parseInt(Math.random()*5)]);
		$popover.addClass('current');
		// 播放再来一次音乐
		setTimeout(function(){
			playAudio($('#agian'));
		},1200);
	}
	function hidePopOver(){
		$popover.removeClass('current');
	}

	// 随机数方法
	function rand_num(n){
		return parseInt(Math.random()*n) + 0.1;
	}

	// 点击说明隐藏，并开始游戏
	var $mc_bg = $('#mc_bg');
	$mc_bg.get(0).volume = 1;
	$start_cover.click(function(){
		$(this).css('opacity',0);
		setTimeout(function(){
			$start_cover.hide();
			bindTouch();
			playAudio($('#mc_bg'));
		},600);
	});
	
	//关闭背景音
	var $btn_mc = $('.btn_mc');
	$btn_mc.click(function(){
		var $this = $(this);
		if($this.hasClass('current')){
			$mc_bg.get(0).play();
		}else{
			$mc_bg.get(0).pause();
		}
		$this.toggleClass('current');
	});

	// 游戏封面点击开始游戏
	var $cover = $('.cover');
	$cover.click(function(){
		hTips();
		$cover.css({
			'opacity':0
		});
		setTimeout(function(){
			$cover.hide();
			playAudio($('#greet'));
		},600);
	});


	var timeBall = null;
	// 雪球变大
	function ballLagger(){
		clearTimeout(timeBall);
		$snowball.css({
			'margin-left':-($snowball.width() + 2)/2,
			'width':$snowball.width() + 2,
			'height':$snowball.height() + 2
		});
		timeBall = setTimeout(ballLagger,ballDelay);
	}

	// 雪球向前滚动
	var snowResult = null;
	function ballRoll(){
		var $pits_li_current = $pits_li.filter('.current');
		var $pits_li_current_span = $pits_li_current.find('span');
		$snowball.css('bottom',210);
		setTimeout(function(){
			$snowball.addClass('anm_css_2').css({
				'left':$pits_li_current_span.offset().left + $pits_li_current_span.width()/2,
				'margin-left':-$snowball.width()/2,
				'bottom':$window.height()*0.2
			});
		});
		var snowball_roll_width = 0;
		// 过小
		if($snowball.width() < $pits_li_current_span.width()-11){
			snowResult = 0;
			snowball_roll_width = -$snowball.width()
		// 过大
		}else if($snowball.width() > $pits_li_current_span.width() + 11){
			snowResult = 1;
			snowball_roll_width = $window.height()*0.2 - ($snowball.width()/2 - Math.sqrt(Math.pow($snowball.width()/2,2) - Math.pow($pits_li_current_span.width()/2,2)))
		// 正好
		}else{
			snowResult = 2;
			snowball_roll_width = $window.width()*0.2-$snowball.width() +10
			// 坑消失 - 填满
			setTimeout(function(){
				$snowball.css('opacity',0);
				$pits_li_current.removeClass('current').next().addClass('current');
			},460);

			// 相似度达到95 奖励
			if($snowball.width() > $pits_li_current_span.width()- 3 && $snowball.width() < $pits_li_current_span.width() + 3){
				setTimeout(Perfect,600);
			}
		}
		setTimeout(function(){
			//console.log(snowball_roll_width);
			$snowball.css({
				'bottom':snowball_roll_width
			});
		},440);
	}

	// 雪球抛物线

	var timeTouch = null;
	var $layout = $('.layout');
	function bindTouch(){
		$layout.bind('touchstart',function(){
			timeBall = setTimeout(ballLagger,ballDelay);
		});
		$layout.bind('touchend',function(){
			clearTimeout(timeBall);
			clearTimeout(timeTouch);
			unBindTouch();
			snowThrow();
			setTimeout(ballRoll,300);
			timeTouch = setTimeout(function(){
				snowWalk();
				snowPit();
			},1000);
		});
	}
	function unBindTouch(){
		$layout.unbind();
	}

	// 雪人逐帧重置到第一帧
	function snowReBg(){
		$snowMan.css({
			'background-position':'left top'
		});
	}

	// 雪人清除所有动作类class
	function  snowManClassDe(){
		$snowMan.removeClass('walk fallen throw wait');
	}

	// 雪人清除所有动作延迟time
	function  clearTimeSnow(){
		clearTimeout(timeWalk);
		clearTimeout(timeThrow);
		clearTimeout(timeFallen);
		clearTimeout(timeWait);
	}

	// 雪人走动动画
	var $snowMan = $('.snowMan');
	var snowMan_w = $snowMan.width();
	var timeWalk = null;
	// console.log(snowMan_h);
	var walk_bg_pos = 0;
	var throw_bg_pos = 0;
	var fallen_bg_pos = 0;


	// 雪人等待
	var wait_bg_pos = 0;
	var timeWait = null;
	function snowWait(rebg){
		clearTimeSnow();
		//清除动作类class
		snowManClassDe();
		$snowMan.addClass('wait');
		timeWait = setTimeout(function(){
			$snowMan.css({
				'background-position':-snowMan_w + 'px top'
			});
		},150);
		timeWait = setTimeout(function(){
			$snowMan.css({
				'background-position':'left top'
			});
		},300);
		timeWait = setTimeout(function(){
			snowWait(1);
		},450);
	}
	//window.snowWait = snowWait;

	// 雪人走动
	function snowWalk(){
		//清除动作类class
		snowManClassDe();
		$snowMan.addClass('walk');
		clearTimeSnow();
		//snowReBg();
		if(walk_bg_pos < snowMan_w*3){
			walk_bg_pos += snowMan_w
		}else{
			walk_bg_pos = 0;
		}
		$snowMan.css({
			'background-position': (-walk_bg_pos) + 'px top'
		})
		//console.log(walk_bg_pos);
		timeWalk = setTimeout(snowWalk,100);
	}
	// snowWalk();

	// 雪人摔跤
	var timeFallen = null;
	// console.log(snowMan_h);
	function snowFallen(){
		//清除动作类class
		snowManClassDe();
		$snowMan.addClass('fallen');
		clearTimeSnow();
		if(fallen_bg_pos < snowMan_w*3){
			fallen_bg_pos += snowMan_w;
			$snowMan.css({
				'background-position': + (-fallen_bg_pos) + 'px top'
			});
			timeFallen = setTimeout(snowFallen,110);
		}else{
			//fallen_bg_pos = 0;
			clearTimeout(timeFallen);
			// snowWalk();
			return false;
		}
	}
	// snowFallen();
	// 雪人扔雪球
	var timeThrow = null;
	function snowThrow(){
		//清除动作类class
		snowManClassDe();
		$snowMan.addClass('throw');
		snowReBg();
		clearTimeSnow();
		if(walk_bg_pos < snowMan_w*6){
			walk_bg_pos += snowMan_w
		}else{
			walk_bg_pos = 0;
			$snowMan.css({
				'background-position': 'left top'
			});
			// snowWalk();
			return false;
		}
		$snowMan.css({
			'background-position': + (-walk_bg_pos) + 'px top'
		});
		timeThrow = setTimeout(snowThrow,110);
	}

	// 雪人过坑
	var timeSnowPit = null;
	function snowPit(){
		clearTimeout(timeSnowPit);
		snowReBg();
		var $currentPit = $pits_li.filter('.current');
		var $currentPit_span = $currentPit.find('span');
		var snow_to_width = 0;
		//根据雪球大小，判断雪人走到的位置
		//console.log(snowResult);
		if(snowResult == 0){
			snow_to_width = parseInt($currentPit_span.offset().left);
		}else if(snowResult == 1){
			snow_to_width = parseInt($snowball.offset().left - $snowball.width()/2);
		}else if(snowResult == 2){
			snow_to_width = 20;
			//当大小合适时，雪人与场景同步动画
			timeSnowPit = setTimeout(scrollBg,100);
		}
		if(snowResult == 0 || snowResult == 1){
			var snowPit_time = 1000
			$snowMan.stop().animate({
				'left':snow_to_width
			},snowPit_time,function(){
				// 执行过坑结果
				FunSnowResult();
				// 不开心声音
				playAudio($('#chapfallen'));
			});
		}else{
			var snowPit_time = 1800;
			playAudio($('#hail'));
		}
		snowWalk();
	}

	// 过坑结果

	function FunSnowResult(){
		var $currentPit = $pits_li.filter('.current');
		// 过小 - 掉落
		if(snowResult == 0){
			$snowMan.stop().animate({
				'bottom':-$snowMan.height(),
				'opacity':0
			});
		// 过大 - 撞死
		}else if(snowResult == 1){
			snowFallen();
		// 正好 - 通过
		}else if(snowResult == 2){
			// $back_bg.css({
			// 	'transform':'translate(-' + $window.width()/2*$currentPit.index() + 'px,0)'
			// });
			// $back_bg_2.css({
			// 	'transform':'translate(-' + $window.width()*$currentPit.index() + 'px,0)'
			// });
			// $pits.css({
			// 	'left':-$window.width()*$currentPit.index()
			// });
			// //console.log('man');
			// $snowMan.stop().animate({
			// 	'left':20
			// },1000,function(){
			// 	reThrow();
			// });
			// wxTitle = '我在【淘气的小雪人】中跨过了' + (parseInt($winNum.html()) + 1) + '个坑，有超过我的吗？'
			// $winNum.html(parseInt($winNum.html()) + 1);
			// onBridgeReady();
		}
		if(snowResult !=2){
			// 失败后弹出提示层
			// showPopOver();
			//console.log(1111);
			setTimeout(showPopOver,1000);
		}
	}

	// 大小刚好合适时，执行的背景动画：雪人静止
	function scrollBg(){
		var $currentPit = $pits_li.filter('.current');
		$back_bg.css({
			'transform':'translate(-' + $window.width()/2*$currentPit.index() + 'px,0)',
			'-webkit-transform':'translate(-' + $window.width()/2*$currentPit.index() + 'px,0)'
		});
		$back_bg_2.css({
			'transform':'translate(-' + $window.width()*$currentPit.index() + 'px,0)',
			'-webkit-transform':'translate(-' + $window.width()*$currentPit.index() + 'px,0)'
		});
		$pits.css({
			'left':-$window.width()*$currentPit.index()
		});
		setTimeout(reThrow,1000);
		wxTitle = '我在【淘气的小雪人】中跨过了' + (parseInt($winNum.html()) + 1) + '个坑，有超过我的吗？'
		$winNum.html(parseInt($winNum.html()) + 1);
		onBridgeReady();
	}

	// 过关后，雪人初始化
	function reThrow(){
		snowManClassDe();
		//snowReBg();
		clearTimeSnow();
		$snowMan.addClass('wait').css({
			'opacity':1,
			'bottom':'20%',
			'left':20,
			'background-position':'left top'
		});
		$snowball.css({
			'left':65,
			'bottom':230,
			'width':30,
			'height':30,
			'margin-left':-15
		});
		// clearTimeout(timeWalk);
		// $snowMan.removeClass('wait').addClass('throw').css('background-position','left top');
		snowWait();
		$snowball.css('opacity',1).removeClass('anm_css_2');
		bindTouch();
	}

	// snowThrow();

	// window resize
	// console.log(snowMan_h);
	$window.resize(function(){
		snowMan_w = $snowMan.width();
		hTips();
	});

	function hTips(){
		if($window.width() > $window.height()){
			tips('请在竖屏下体验哦！');
		}else{
			hideTips();
			setKeng();
			popOverSize();
		}
	}

	function tips(txt){
		if(!$('#hMask').length){
			$('body').append('<div id="hMask" style="position:absolute;left:0; top:0; right:0; bottom:0; z-index:999; background-color:rgba(255,255,255,0)"><div style="position:absolute; left:20px; right:20px; top:50%; margin-top:-15px; color:#fff; height:30px; line-height:30px; background-color:rgba(0,0,0,0.6); text-align:center; border-radius:4px;">' + txt + '</div></div>');	
		}
	};
	function hideTips(){
		$('#hMask').remove();
		//window.location.reload();
	}

	// // 游戏重新开始
	// function reStart(){
	// 	// window.location.reload();
	// 	clearTimeSnow();
	// 	wxTitle = '我在【淘气的小雪人】中跨过了0个坑，有超过我的吗？';
	// 	$popover.find('i').html(0);
	// 	$winNum.html(0);
	// 	$pits.removeClass('pits_anm');
	// 	$pits.css('left',0);
	// 	$pits.addClass('pits_anm');
	// 	$pits_li.removeClass('current').eq(0).addClass('current');
	// 	$popover.removeClass('current');
	// 	$back_bg.add($back_bg_2).removeClass('back_bg_anm');
	// 	$back_bg.add($back_bg_2).css({
	// 		'transform':'translate(0,0)',
	// 		'-webkit-transform':'translate(0,0)'
	// 	});
	// 	$back_bg.add($back_bg_2).removeClass('back_bg_anm').addClass('back_bg_anm');
	// 	reThrow();
	// }
	// 游戏重新开始
	function reStart(){
		// window.location.reload();
		clearTimeSnow();
		wxTitle = '我在【淘气的小雪人】中跨过了0个坑，有超过我的吗？';
		$popover.find('i').html(0);
		$winNum.html(0);
		$pits.removeClass('pits_anm');
		$pits.css('left',0);
		setTimeout(function(){
			$pits.addClass('pits_anm');
		});
		$pits_li.removeClass('current').eq(0).addClass('current');
		$popover.removeClass('current');
		$back_bg.add($back_bg_2).removeClass('back_bg_anm');
		$back_bg.add($back_bg_2).css({
			'transform':'translate(0,0)',
			'-webkit-transform':'translate(0,0)'
		});
		setTimeout(function(){
			$back_bg.add($back_bg_2).addClass('back_bg_anm');
		});
		reThrow();
	}
	// 绑定刷新功能
	$('.ac_restart').click(function(){
		reStart();
	});

	// 过关数连+3
	function addContinuous(n){
		var maxN = n;
		var thisN = 1;
		function add(){
			if(thisN < maxN){
				$winNum.html(parseInt($winNum.html()) + 1);
				thisN += 1;
				setTimeout(add,120);
				wxTitle = '我在【淘气的小雪人】中跨过了' + (parseInt($winNum.html()) + 1) + '个坑，有超过我的吗？'
				onBridgeReady();
			}
		}
		add();
	}

	// 完美过关调用
	var $wanmei = $('.wanmei');
	function Perfect(){
		$wanmei.addClass('current');
		setTimeout(function(){
			$wanmei.addClass('over').removeClass('current');
			addContinuous(4);
		},1200);
		setTimeout(function(){
			$wanmei.removeClass('over');
		},1600);
	}


	// 分享弹出
	var $sharePop = $('.sharePop');
	$('.ac_share').click(function(){
		$sharePop.addClass('current');
		setTimeout(function(){
			$sharePop.removeClass('current');
		},2000);
		// 播放分享声音
		playAudio($('#zan'));
	});

	// 播放指定声音方法
	function playAudio(element){
		if(!$btn_mc.hasClass('current')){
			element.get(0).play();
		}
	}
});
</script>
</body>
</html><!--[if !IE]>|xGv00|15f3ac06d90e4ff36c8402db31d420e8<![endif]-->