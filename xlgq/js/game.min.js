"use strict";$(function(){var c="ontouchstart" in window,b=c?"tap":"tap",d=c?"touchstart":"mousedown",f=c?"touchmove":"mousemove",e=c?"touchend":"mouseup";var a={currentBridge:null,myInterval:null,role:$(".role"),bridge:$(".bridge"),lineHeight:null,currentLevel:0,soundStatus:false,bgInterval:null,intervalTime:5000,init:function(){$(".loading").animate({opacity:0},600,"",function(){$(this).hide()});$(".tishi").show();$(".iknow").on(d,function(){$(".tishi").hide();$(".main").show()});this.addEvent();function g(){var h='<audio id="bgMusic" loop="loop" src= "http://cdnwx.jkbk.cn/xly/wx/sweets/bgMusic.mp3"></audio>';$("body").append(h)}g();this.playSound(true)},playSound:function(g){if(!g){document.getElementById("bgMusic").pause();this.soundStatus=false}else{document.getElementById("bgMusic").play();this.soundStatus=true}},addEvent:function(){var j=this;var g=false;document.addEventListener(d,h,false);var i=false;function h(k){if(k&&k.target.tagName=="INPUT"){return}if(k&&k.target.tagName=="BUTTON"){return}if(k&&k.target.tagName=="SECTION"){return}if(!i){k.preventDefault()}}$("img").on(d,h);$(".infoPage").find(".gameStartBtn").on(d,function(){if(g){return}$(".infoPage").fadeOut(400,function(){j.addDrawLineEvent();$(".infoPage").hide();g=false});j.clearBgInterval();j.enterPage();j.createBridge();g=true});$(".btnIco").on(e,function(){var l=$(this);if(l.hasClass("myBtn")){$(".myPanel").show();$(".ck").one(e,function(){$(".myPanel").hide()})}else{if(l.hasClass("ruleBtn")){$(".rulePanel").show();$(".rulePanel").find(".closeBtn").one(e,function(){$(".rulePanel").hide();i=false});i=true}else{if(l.hasClass("musicBtn")){j.soundStatus=!j.soundStatus;j.playSound(j.soundStatus)}else{if(l.hasClass("viewBtn")){$(".paihang").show();$("#ad").show();var k={"action":"top",};$.post("sub.php",k,function(m){setTimeout(function(){$("#ad").hide();$("#ranking_list").html(m.res);$("#ranking_title").html("我的排行："+m.myrank)},2000)},"json");$("#return_back").one(e,function(){$(".paihang").hide()})}}}}})},enterPage:function(){var i=this,h=this.role,g=this.bridge;this.setCss3(g,"translate(0px,100%)");this.setCss3(h,"translate(-50px,0)");window.setTimeout(function(){i.setCss3(g,"translate(0,0)","all 0.5s");window.setTimeout(function(){h.addClass("roleRunAm");h.attr("data-currentx",70);i.setCss3(h,"translate(70px,0)","all .6s linear");setTimeout(function(){h.removeClass("roleRunAm")},600)},500)},600);$(".game,.gameBg").show();this.bgAutoPlay()},addDrawLineEvent:function(){var g=this;$(".hit").one(d,function(){g.drawLineStart();$(this).one(e,function(){g.drawLineStop(function(){g.advance()})})})},nextLevel:function(){var g=this;this.createBridge();this.addDrawLineEvent();this.currentLevel++;this.saveLevelLog()},saveLevelLog:function(){var g=localStorage.getItem("bestLevel");var h=localStorage.getItem("levelNum");var i=this.currentLevel;if(g){if(g<i){localStorage.setItem("bestLevel",i)}}else{localStorage.setItem("bestLevel",1)}console.log("bestLevel:",localStorage.getItem("bestLevel"))},getBestLevel:function(){var g=localStorage.getItem("bestLevel");return g?g:0},setLevelNum:function(){var g=localStorage.getItem("levelNum");if(g){localStorage.setItem("levelNum",Number(g)++)}else{localStorage.setItem("levelNum",0)}},getLevelNum:function(){var g=localStorage.getItem("levelNum");return g?g:0},advance:function(){var q=this,k=this.role,w=this.bridge,s=this.currentBridge,v=Number(k.attr("data-currentx")),l=parseInt(s.css("left"));l=l?l:0;var t=w.find("li").last();var i=Number(t.attr("data-currentx"));var u=this.lineHeight;var j=Number(t.width());var m=Number(s.width());var r=i-l-m;var n=(u>=r&&u<=r+j)?true:false;var o=u+v;var p=l+(i-l)+j-50;var h=n?p:o+30;var g=(h-l)/500;this.setCss3(k,"translate("+h+"px,0)","all "+g+"s linear");k.addClass("roleRunAm");window.setTimeout(function(){k.removeClass("roleRunAm");if(n){q.nextLevel();k.attr("data-currentx",h);q.setCss3($(".game"),"translate("+-(h-j+30)+"px, 0)","all 0.5s ease")}else{q.gameOver();q.setTransition(k,"all 0.2s linear");k.css("top",$(".game").height());q.setCss3(s.find(".line span"),"rotate(180deg)","all 0.5s")}},g*1000);console.log("isPass:::",n)},isContinue:function(){},createBridge:function(){var m=this,j=this.role,p=this.bridge,k=640,n=40;var i=n+Math.round(Math.random()*70);var o=p.find("li").last();this.currentBridge=o;var g=o.width();var h=Math.round((k-g-n-i-30)*Math.random())+(n+g)+Number(o.attr("data-currentx"));var l='<li class="animated slideInUp" data-currentx="'+h+'" style="width:'+i+"px; left:"+h+'px;"><div class="line"><span></span></div></li>';p.find("ul").append(l)},bgAutoPlay:function(){var h=this;var g=$(".gameBg").find(".bg3");g.show()},drawLineStart:function(){var j=this;var g=this.currentBridge,i=g.find(".line"),h=i.find("span");this.lineHeight=0;this.myInterval=window.setInterval(function(){j.lineHeight+=10;h.height(j.lineHeight)},30)},drawLineStop:function(i){var g=this.currentBridge;var h=g.find(".line span");if(this.myInterval){window.clearInterval(this.myInterval);this.myInterval=null}this.setCss3(h,"rotate(90deg)","all 0.4s ease");
window.setTimeout(function(){if(i){i()}},400)},reset:function(){var k=this.role;var h=this.bridge;var g=h.find("li").length;for(var j=0;j<g;j++){if(j>0){h.find("li").eq(1).remove()}}k.attr("data-currentx",70);this.setCss3($(".game"),"translate(0, 0)");this.setCss3(k,"none","none");k.css("top","-75px");this.setCss3(h.find("li").first().find(".line span"),"rotate(0deg)","none",{height:0});this.currentLevel=0;this.clearBgInterval();$(".hit").unbind("touchstart mousedown")},clearBgInterval:function(){if(this.bgInterval){window.clearInterval(this.bgInterval);this.bgInterval=null}},again:function(){var g=this;this.reset();this.enterPage();this.createBridge();this.addDrawLineEvent()},gameStart:function(){},gameOver:function(){var h=this.currentLevel;var g=this.getBestLevel;var i=this;$(".failPanel").show();$(".back").one(e,function(){$(".failPanel").hide();i.again()});$(".failPanel").find(".failTxt").find("img").hide();$(".failPanel").find(".failTxt").find("img").eq(0).show();$(".failPanel").find(".failTxt").find("img").eq(1).show();$(".failPanel").find(".success_txt").show();$(".failPanel").find(".success_txt").text(h);$(".failPanel").find(".best_txt").show();$(".failPanel").find(".best_txt").text(g);this.postGameLevel()},postGameLevel:function(){var h=this.currentLevel;var g={'now':(new Date()).getTime(),"score":h};window._send_msg("./sub.php?action=post&msg=",g,function(i){console.log(i.msg)})},getServerLevelData:function(g){},getQueryString:function(g){var h=new RegExp("(^|&)"+g+"=([^&]*)(&|$)","i");var i=window.location.search.substr(1).match(h);if(i!=null){return unescape(i[2])}return null},setDur:function(i,h,g){var h=h||1;var g=g||0;i.css({"-webkit-animation-duration":h+"s !important","animation-duration":h+"s !important","-webkit-animation-delay":g+"s","animation-delay":g+"s"})},setCss3:function(j,i,h,g){var i=i||"none",h=h||"none";j.css({"transform":i,"transition":h,"-webkit-transform":i,"-webkit-transition":h});if(g){j.css(g)}},setTransition:function(h,g){var g=g||"none";h.css({"transition":g,"-webkit-transition":g})}};window.onload=function(){a.init()}});